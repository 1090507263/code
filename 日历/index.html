<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<script type="text/javascript">
			window.onload = function(){
				function calendarPlug(attr){
					var attr = attr.id;
					//获取日历载体
					var calendar = document.getElementById('calendar');
					//当前时间
					var currentTime = new Date();
					//当前年份
					var year = currentTime.getFullYear();
					//年前月份
					var monthly = currentTime.getMonth();
					calendarHtml(year,monthly);
					//获取日历tbody
					var calendarTbody = calendar.querySelector('.calendar-table');;
					//给日历添加点击事件
					calendarTbody.onclick = function(ev){
						var target = ev.target;
						if (target.className === "valid") {
							alert(year + "-" + monthly + "-" + target.innerHTML)
						}
					}
					//上个月、下个月
					var calendarPrev = calendar.querySelector('.calendar-prev');
					var calendarNext = calendar.querySelector('.calendar-next');
					//上个月
					calendarPrev.onclick = function(){
						if (monthly) {
							monthly = monthly - 1;
						}else{
							year = year - 1;
							monthly = 11;
						}
						calendarHtml(year,monthly);
					}
					calendarNext.onclick = function(){
						if (monthly == 11) {
							year = year + 1;
							monthly = 0;
						}else{
							monthly = monthly + 1;
						}
						calendarHtml(year,monthly);
					}
					
					function calendarHtml(year,monthly){
						console.log(year + "年" + (monthly + 1) + "月" );
						//定义当年12个月份每个月的日期天数
						var monthlyDays = [31,28+leap(year),31,30,31,31,30,31,30,31,30,31];
						//当月一号是星期几
						var nWeek = new Date(year,monthly,1).getDay();
						//循环表格所需行数
						var trNum =  Math.ceil((monthlyDays[monthly] + nWeek) / 7);
						//循环日历
						var trHtml = "";
						for (var i = 0; i < trNum; i++) {
							trHtml += "<tr>";
							for (var j = 0; j < 7; j++) {
								var idx = Number(i * 7 + j); //给每个tr加序号
								var dateStr = idx - nWeek + 1; //计算日期
								//如果dateStr大于0则是本月日期
								if(dateStr > 0 && dateStr <= monthlyDays[monthly]){
									trHtml += "<td class='valid'>"+ dateStr +"</td>";
								}else{
									trHtml += "<td></td>";
								}
							}
							trHtml += "</tr>";
						}
						//整体table
						var tableHtml = "<table><thead><tr><td>日</td><td>一</td><td>二</td><td>三</td><td>四</td><td>五</td><td>六</td></tr></thead><tbody>" + trHtml + "</tbody></table>";
						var calendarTable = calendar.querySelector('.calendar-table');
						if (calendarTable) {
							calendarTable.innerHTML = tableHtml;
						}else{
							calendar.innerHTML += "<div class='calendar-table'>" + tableHtml + "</div>";
						}
					}
					//计算是否润年，是返回1，否返回0
					function leap(year){
						return ( year % 100 == 0?( year % 400 == 0?1:0):( year % 4 ==0?1:0));
					}
				}
				calendarPlug({
					id:"calendar"
				})
			}
		</script>
	</head>
	<body>
		<div id="calendar">
			<div class="calendar-prev">上一页</div>
			<div class="calendar-next">下一页</div>
		</div>
	</body>
</html>